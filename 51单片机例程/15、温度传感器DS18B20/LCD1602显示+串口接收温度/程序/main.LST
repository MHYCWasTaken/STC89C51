C51 COMPILER V9.01   MAIN                                                                  04/17/2015 20:45:39 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: d:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*******************************************************************************
   2          *                 
   3          *                                      ÆÕÖÐ¿Æ¼¼
   4          --------------------------------------------------------------------------------
   5          * Êµ Ñé Ãû               : 18B20ÎÂ¶ÈÏÔÊ¾ÊÔÑé
   6          * ÊµÑéËµÃ÷       : LCD1602ÏÔÊ¾ÎÂ¶ÈÖµ£¬²¢ÇÒ½«ÎÂ¶ÈÖµÍ¨¹ý´®¿Ú·¢ËÍµ½µçÄÔÉÏ¡£
   7          * Á¬½Ó·½Ê½       : ¼ûÁ¬½ÓÍ¼
   8          * ×¢    Òâ               : 
   9          *******************************************************************************/
  10          
  11          #include<reg51.h>
  12          #include"lcd.h"
  13          #include"temp.h"
  14          
  15          uchar CNCHAR[6] = "ÉãÊÏ¶È";
  16          void LcdDisplay(int);
  17          void UsartConfiguration();
  18          
  19          /*******************************************************************************
  20          * º¯ÊýÃû         : main
  21          * º¯Êý¹¦ÄÜ                 : Ö÷º¯Êý
  22          * ÊäÈë           : ÎÞ
  23          * Êä³ö           : ÎÞ
  24          *******************************************************************************/
  25          
  26          void main()
  27          {
  28   1              UsartConfiguration();
  29   1              LcdInit();                       //³õÊ¼»¯LCD1602
  30   1              LcdWriteCom(0x88);       //Ð´µØÖ· 80±íÊ¾³õÊ¼µØÖ·
  31   1              LcdWriteData('C'); 
  32   1              while(1)
  33   1              {
  34   2                      LcdDisplay(Ds18b20ReadTemp());
  35   2              }
  36   1      }
  37          
  38          /*******************************************************************************
  39          * º¯ÊýÃû         : LcdDisplay()
  40          * º¯Êý¹¦ÄÜ                 : LCDÏÔÊ¾¶ÁÈ¡µ½µÄÎÂ¶È
  41          * ÊäÈë           : v
  42          * Êä³ö           : ÎÞ
  43          *******************************************************************************/
  44          
  45          void LcdDisplay(int temp)        //lcdÏÔÊ¾
  46          {
  47   1          
  48   1              unsigned char i, datas[] = {0, 0, 0, 0, 0}; //¶¨ÒåÊý×é
  49   1              float tp;  
  50   1              if(temp< 0)                                 //µ±ÎÂ¶ÈÖµÎª¸ºÊý
  51   1              {
  52   2                      LcdWriteCom(0x80);              //Ð´µØÖ· 80±íÊ¾³õÊ¼µØÖ·
  53   2                      SBUF='-';               //½«½ÓÊÕµ½µÄÊý¾Ý·ÅÈëµ½·¢ËÍ¼Ä´æÆ÷
  54   2                      while(!TI);                              //µÈ´ý·¢ËÍÊý¾ÝÍê³É
  55   2                      TI=0;                                            //Çå³ý·¢ËÍÍê³É±êÖ¾Î»
C51 COMPILER V9.01   MAIN                                                                  04/17/2015 20:45:39 PAGE 2   

  56   2                  LcdWriteData('-');               //ÏÔÊ¾¸º
  57   2                      //ÒòÎª¶ÁÈ¡µÄÎÂ¶ÈÊÇÊµ¼ÊÎÂ¶ÈµÄ²¹Âë£¬ËùÒÔ¼õ1£¬ÔÙÈ¡·´Çó³öÔ­Âë
  58   2                      temp=temp-1;
  59   2                      temp=~temp;
  60   2                      tp=temp;
  61   2                      temp=tp*0.0625*100+0.5; 
  62   2                      //ÁôÁ½¸öÐ¡Êýµã¾Í*100£¬+0.5ÊÇËÄÉáÎåÈë£¬ÒòÎªCÓïÑÔ¸¡µãÊý×ª»»ÎªÕûÐÍµÄÊ±ºò°ÑÐ¡Êýµã
  63   2                      //ºóÃæµÄÊý×Ô¶¯È¥µô£¬²»¹ÜÊÇ·ñ´óÓÚ0.5£¬¶ø+0.5Ö®ºó´óÓÚ0.5µÄ¾ÍÊÇ½ø1ÁË£¬Ð¡ÓÚ0.5µÄ¾Í
  64   2                      //ËãÓÉÏ0.5£¬»¹ÊÇÔÚÐ¡ÊýµãºóÃæ¡£
  65   2       
  66   2              }
  67   1              else
  68   1              {                       
  69   2                      LcdWriteCom(0x80);              //Ð´µØÖ· 80±íÊ¾³õÊ¼µØÖ·
  70   2                  LcdWriteData('+');          //ÏÔÊ¾Õý
  71   2                      SBUF='+';//½«½ÓÊÕµ½µÄÊý¾Ý·ÅÈëµ½·¢ËÍ¼Ä´æÆ÷
  72   2                      while(!TI);                              //µÈ´ý·¢ËÍÊý¾ÝÍê³É
  73   2                      TI=0;                                            //Çå³ý·¢ËÍÍê³É±êÖ¾Î»
  74   2                      tp=temp;//ÒòÎªÊý¾Ý´¦ÀíÓÐÐ¡ÊýµãËùÒÔ½«ÎÂ¶È¸³¸øÒ»¸ö¸¡µãÐÍ±äÁ¿
  75   2                      //Èç¹ûÎÂ¶ÈÊÇÕýµÄÄÇÃ´£¬ÄÇÃ´ÕýÊýµÄÔ­Âë¾ÍÊÇ²¹ÂëËü±¾Éí
  76   2                      temp=tp*0.0625*100+0.5; 
  77   2                      //ÁôÁ½¸öÐ¡Êýµã¾Í*100£¬+0.5ÊÇËÄÉáÎåÈë£¬ÒòÎªCÓïÑÔ¸¡µãÊý×ª»»ÎªÕûÐÍµÄÊ±ºò°ÑÐ¡Êýµã
  78   2                      //ºóÃæµÄÊý×Ô¶¯È¥µô£¬²»¹ÜÊÇ·ñ´óÓÚ0.5£¬¶ø+0.5Ö®ºó´óÓÚ0.5µÄ¾ÍÊÇ½ø1ÁË£¬Ð¡ÓÚ0.5µÄ¾Í
  79   2                      //Ëã¼ÓÉÏ0.5£¬»¹ÊÇÔÚÐ¡ÊýµãºóÃæ¡£
  80   2              }
  81   1              datas[0] = temp / 10000;
  82   1              datas[1] = temp % 10000 / 1000;
  83   1              datas[2] = temp % 1000 / 100;
  84   1              datas[3] = temp % 100 / 10;
  85   1              datas[4] = temp % 10;
  86   1      
  87   1              LcdWriteCom(0x82);                  //Ð´µØÖ· 80±íÊ¾³õÊ¼µØÖ·
  88   1              LcdWriteData('0'+datas[0]); //°ÙÎ» 
  89   1              SBUF = '0'+datas[0];        //½«½ÓÊÕµ½µÄÊý¾Ý·ÅÈëµ½·¢ËÍ¼Ä´æÆ÷
  90   1              while (!TI);                        //µÈ´ý·¢ËÍÊý¾ÝÍê³É
  91   1              TI = 0;
  92   1              
  93   1              LcdWriteCom(0x83);                  //Ð´µØÖ· 80±íÊ¾³õÊ¼µØÖ·
  94   1              LcdWriteData('0'+datas[1]); //Ê®Î»
  95   1              SBUF = '0'+datas[1];        //½«½ÓÊÕµ½µÄÊý¾Ý·ÅÈëµ½·¢ËÍ¼Ä´æÆ÷
  96   1              while (!TI);                        //µÈ´ý·¢ËÍÊý¾ÝÍê³É
  97   1              TI = 0;
  98   1      
  99   1              LcdWriteCom(0x84);                  //Ð´µØÖ· 80±íÊ¾³õÊ¼µØÖ·
 100   1              LcdWriteData('0'+datas[2]); //¸öÎ» 
 101   1              SBUF = '0'+datas[2];        //½«½ÓÊÕµ½µÄÊý¾Ý·ÅÈëµ½·¢ËÍ¼Ä´æÆ÷
 102   1              while (!TI);                        //µÈ´ý·¢ËÍÊý¾ÝÍê³É
 103   1              TI = 0;
 104   1      
 105   1              LcdWriteCom(0x85);              //Ð´µØÖ· 80±íÊ¾³õÊ¼µØÖ·
 106   1              LcdWriteData('.');              //ÏÔÊ¾ ¡®.¡¯
 107   1              SBUF = '.';             //½«½ÓÊÕµ½µÄÊý¾Ý·ÅÈëµ½·¢ËÍ¼Ä´æÆ÷
 108   1              while (!TI);                    //µÈ´ý·¢ËÍÊý¾ÝÍê³É
 109   1              TI = 0;
 110   1      
 111   1              LcdWriteCom(0x86);                  //Ð´µØÖ· 80±íÊ¾³õÊ¼µØÖ·
 112   1              LcdWriteData('0'+datas[3]); //ÏÔÊ¾Ð¡Êýµã  
 113   1              SBUF = '0'+datas[3];        //½«½ÓÊÕµ½µÄÊý¾Ý·ÅÈëµ½·¢ËÍ¼Ä´æÆ÷
 114   1              while (!TI);                        //µÈ´ý·¢ËÍÊý¾ÝÍê³É
 115   1              TI = 0;
 116   1      
 117   1              LcdWriteCom(0x87);                  //Ð´µØÖ· 80±íÊ¾³õÊ¼µØÖ·
C51 COMPILER V9.01   MAIN                                                                  04/17/2015 20:45:39 PAGE 3   

 118   1              LcdWriteData('0'+datas[4]); //ÏÔÊ¾Ð¡Êýµã 
 119   1              SBUF = '0'+datas[4];        //½«½ÓÊÕµ½µÄÊý¾Ý·ÅÈëµ½·¢ËÍ¼Ä´æÆ÷
 120   1              while (!TI);                        //µÈ´ý·¢ËÍÊý¾ÝÍê³É
 121   1              TI = 0;
 122   1              for(i=0; i<6; i++)
 123   1              {
 124   2                      SBUF = CNCHAR[i];       //½«½ÓÊÕµ½µÄÊý¾Ý·ÅÈëµ½·¢ËÍ¼Ä´æÆ÷
 125   2                      while (!TI);            //µÈ´ý·¢ËÍÊý¾ÝÍê³É
 126   2                      TI = 0;
 127   2              }
 128   1      
 129   1               
 130   1      }
 131          /*******************************************************************************
 132          * º¯ Êý Ãû         : UsartConfiguration()
 133          * º¯Êý¹¦ÄÜ                 : ÉèÖÃ´®¿Ú
 134          * Êä    Èë         : ÎÞ
 135          * Êä    ³ö         : ÎÞ
 136          *******************************************************************************/
 137          
 138          void UsartConfiguration()
 139          {
 140   1              SCON=0X50;                      //ÉèÖÃÎª¹¤×÷·½Ê½1
 141   1              TMOD=0X20;                      //ÉèÖÃ¼ÆÊýÆ÷¹¤×÷·½Ê½2
 142   1              PCON=0X80;                      //²¨ÌØÂÊ¼Ó±¶
 143   1              TH1=0XF3;                               //¼ÆÊýÆ÷³õÊ¼ÖµÉèÖÃ£¬×¢Òâ²¨ÌØÂÊÊÇ4800µÄ
 144   1              TL1=0XF3;
 145   1      //      ES=1;                                           //´ò¿ª½ÓÊÕÖÐ¶Ï
 146   1      //      EA=1;                                           //´ò¿ª×ÜÖÐ¶Ï
 147   1              TR1=1;                                  //´ò¿ª¼ÆÊýÆ÷
 148   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    437    ----
   CONSTANT SIZE    =      5    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6      11
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
